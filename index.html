<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>å¤©ä½¿å¹¸ç¦æ™ºæ…§åç‰‡ V339</title>

  <link rel="manifest" href="./manifest.json?v=339" />
  <meta name="theme-color" content="#ee5253" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet" />

  <style>
    :root { --p:#ee5253; --s:#d63031; --bg:#f5f6fa; }

    .warm-pink   { --p:#ee5253; --s:#d63031; }
    .aurora-blue { --p:#00a8ff; --s:#0097e6; }
    .vivid-orange{ --p:#f0932b; --s:#eb4d4b; }
    .royal-purple{ --p:#6c5ce7; --s:#4834d4; }
    .teal-green  { --p:#20bf6b; --s:#0b8d51; }

    body{
      font-family:'Noto Sans TC',sans-serif;
      margin:0;
      background:
        radial-gradient(1200px 600px at 50% -200px, rgba(255,255,255,0.9), rgba(255,255,255,0)),
        linear-gradient(180deg, #f7f8fb 0%, var(--bg) 60%);
      display:flex;
      flex-direction:column;
      align-items:center;
      min-height:100vh;
    }

    /* top admin */
    #admin-panel{
      width:100%;
      background:rgba(255,255,255,0.92);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      text-align:center;
      padding:15px 0 10px;
      border-bottom:1px solid rgba(0,0,0,0.06);
      z-index:2000;
      flex-shrink:0;
    }
    .picker-group{ display:flex; justify-content:center; gap:12px; margin-bottom:8px; align-items:center; }
    .dot{
      width:32px;height:32px;border-radius:50%;
      cursor:pointer;border:3px solid white;
      box-shadow:0 8px 18px rgba(0,0,0,0.14);
      transition: transform .15s ease;
    }
    .dot:active{ transform: scale(0.96); }

    .btn-style{
      padding:7px 14px;border-radius:20px;border:1px solid rgba(0,0,0,0.12);
      font-size:11px;cursor:pointer;background:#fff;font-weight:900;
      box-shadow:0 6px 16px rgba(0,0,0,0.05);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .btn-style:active{ transform: scale(0.97); }
    .btn-style.active{ background:#2f3640!important; color:white!important; border-color:#2f3640!important; }

    .hint-bounce{
      font-size:12px;
      font-weight:900;
      color:#2d3436;
      opacity:0.9;
      letter-spacing:0.5px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      user-select:none;
      animation: hintFloat 1.2s ease-in-out infinite;
    }
    .hint-bounce i{ color:var(--p); }
    @keyframes hintFloat{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-3px); }
    }

    /* card */
    .card{
      background:rgba(255,255,255,0.96);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      width:92%;
      max-width:380px;
      height:680px;
      border-radius:45px;
      overflow:hidden;
      box-shadow:0 28px 60px rgba(0,0,0,0.14);
      position:relative;
      margin:20px 0;
      display:flex;
      flex-direction:column;
      border: 1px solid rgba(0,0,0,0.06);
    }

    .banner{
      height:160px;
      background:linear-gradient(135deg,var(--p),var(--s));
      flex-shrink:0;
      position:relative;
    }
    .arch-overlay{
      position:absolute;width:100%;height:90px;background:white;
      bottom:-1px;border-radius:90px 90px 0 0;
    }
    .style-flat .arch-overlay{ border-radius:0; height:35px; }
    .style-spot .arch-overlay{ border-radius:50% 50% 0 0; transform:scaleX(1.4); height:100px; }

    .avatar-wrap{
      width:130px;height:130px;background:#fff;border-radius:50%;
      padding:6px;box-shadow:0 10px 25px rgba(0,0,0,0.10);
      position:absolute;top:35px;left:50%;transform:translateX(-50%);
      z-index:100;
      border: 1px solid rgba(0,0,0,0.06);
    }
    .avatar{ width:100%;height:100%;border-radius:50%;object-fit:cover; }

    .mode-main .avatar-wrap{ border-radius:50%; }
    .mode-main .avatar{ border-radius:50%; }

    .info-scroll{
      flex:1; overflow-y:auto; padding:45px 20px 0; text-align:center;
      scrollbar-width:none;
    }
    .info-scroll::-webkit-scrollbar{ display:none; }

    .name{ font-size:26px; font-weight:900; color:#2d3436; margin:5px 0; }
    .unit{ font-size:14px; color:var(--s); font-weight:800; margin-bottom:6px; }
    .motto{
      font-size:13px;color:#2d3436;opacity:0.9;font-weight:700;
      margin:0 0 8px;line-height:1.5;
    }

    .brand-logo-below{
      width:52px;height:52px;border-radius:16px;
      background:rgba(255,255,255,0.95);
      display:none; align-items:center; justify-content:center;
      overflow:hidden;
      box-shadow:0 10px 18px rgba(0,0,0,0.10);
      border:1px solid rgba(0,0,0,0.06);
      margin:8px auto 8px;
    }
    .brand-logo-below img{ width:100%;height:100%;object-fit:cover; }

    .social-bar{ display:flex; justify-content:center; align-items:center; gap:15px; margin:15px 0 20px; }
    .social-link{
      width:45px;height:45px;border-radius:14px;background:#fff;
      display:none; align-items:center; justify-content:center;
      text-decoration:none;font-size:20px;color:var(--s);
      box-shadow:0 10px 22px rgba(0,0,0,0.08);
      border:1px solid rgba(0,0,0,0.06);
      transition: transform .15s ease;
    }
    .social-link:active{ transform: scale(0.97); }

    .content-box{
      text-align:left;background:#ffffff;padding:18px;border-radius:25px;
      margin-bottom:15px;
      box-shadow: 0 10px 22px rgba(0,0,0,0.06);
      border:1px solid rgba(0,0,0,0.06);
    }
    .label{ color:#adb5bd;font-weight:900;font-size:11px;margin-bottom:8px;display:block; }

    .img-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
    .img-grid a{ display:block; }
    .img-grid img{
      width:100%; height:78px; object-fit:cover; border-radius:14px;
      border:1px solid rgba(0,0,0,0.06); background:#f7f7f7;
    }

    .faq-item{ background:#fafafa;border:1px solid rgba(0,0,0,0.06);border-radius:16px;padding:12px 12px;margin-top:10px; }
    .faq-q{ font-weight:900;color:#2d3436;font-size:13px;margin-bottom:6px; }
    .faq-a{ color:#2d3436;font-size:13px;line-height:1.7;white-space:pre-wrap; }

    .bottom-guide-bar{ padding:5px 0 20px; text-align:center; }
    .mini-install-btn{
      background:#fff; color:var(--p); border:1.5px solid var(--p);
      padding:6px 15px; border-radius:50px; font-size:12px; font-weight:900;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,0.06);
    }
    .mini-install-btn:active{ transform: scale(0.98); }

    /* âœ… v339ï¼šè¯ç¹«å€ç¶­æŒ v338 çš„ç¸®é«˜ */
    .actions{
      background: linear-gradient(180deg, rgba(255,255,255,0.90) 0%, rgba(255,255,255,0.98) 100%);
      padding:10px 12px 14px;
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
      flex-shrink:0;
      border-top:1px solid rgba(0,0,0,0.06);
    }

    .act-btn{
      text-decoration:none;
      background:#ffffff;
      padding:10px 10px;
      border-radius:16px;
      color:#2f3542;
      font-size:12.5px;
      font-weight:900;
      text-align:left;
      border:1px solid rgba(0,0,0,0.08);
      display:flex;
      align-items:center;
      gap:9px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.08);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .act-btn:active{ transform: scale(0.988); box-shadow: 0 8px 16px rgba(0,0,0,0.10); }

    .act-btn .icon-bubble{
      width:34px;height:34px;
      border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      background: rgba(255,255,255,0.9);
      border: 1px solid rgba(0,0,0,0.08);
      box-shadow: 0 8px 14px rgba(0,0,0,0.08);
      flex: 0 0 auto;
    }
    .act-btn .icon-bubble i{
      font-size:16px;
      color: var(--p);
    }
    .act-btn .label-txt{
      display:block;
      font-weight:900;
      letter-spacing:0.2px;
      line-height:1.15;
    }

    .btn-main{
      grid-column:span 2;
      background: linear-gradient(145deg, #06C755, #05af4b) !important;
      color: white !important;
      border: none !important;
      box-shadow: 0 14px 28px rgba(6,199,85,0.26);
    }
    .btn-main .icon-bubble{
      width:36px;height:36px;
      background: rgba(255,255,255,0.18);
      border: 1px solid rgba(255,255,255,0.25);
      box-shadow: none;
    }
    .btn-main .icon-bubble i{ color: #ffffff; }

    .btn-sub{
      background: #ffffff !important;
      border: 2px solid rgba(6,199,85,0.35) !important;
      box-shadow: 0 12px 22px rgba(6,199,85,0.10);
    }
    .btn-sub .icon-bubble i{ color:#06C755; }

    .btn-wechat .icon-bubble i{ color:#07C160; }
    .btn-mail   .icon-bubble i{ color:#2d3436; }
    .btn-phone  .icon-bubble i{ color:#2d3436; }

    .line-guide{
      grid-column: span 2;
      background: #f7fff9;
      border: 1px solid rgba(6,199,85,0.22);
      color: #1f7a46;
      font-size: 11.5px;
      font-weight: 900;
      padding: 7px 10px;
      border-radius: 12px;
      text-align: center;
      display: none;
      box-shadow: 0 8px 16px rgba(0,0,0,0.05);
    }

    /* âœ… v339ï¼šå¾Œå°å…¥å£æ”¹ç‚ºå¡ç‰‡å³ä¸‹è§’é€æ˜ç†±å€ï¼ˆæ°¸é é»å¾—åˆ°ï¼‰ */
    #secret-gate{
      position:absolute;
      right:10px;
      bottom:10px;
      width:64px;
      height:64px;
      border-radius:18px;
      background: rgba(0,0,0,0.0);
      z-index:9000;
    }

    /* modal */
    #install-modal{
      display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.85); z-index:10000;
      align-items:center; justify-content:center; padding:20px;
    }
    .modal-content{ background:white; width:100%; max-width:320px; border-radius:35px; padding:25px; position:relative; }
    .close-modal{ position:absolute; top:15px; right:20px; font-size:24px; color:#999; cursor:pointer; }
    .modal-tab{ display:flex; gap:8px; margin:15px 0; }
    .tab-btn{ flex:1; padding:8px; border-radius:10px; border:1px solid #ddd; background:#f8f9fa; font-size:12px; font-weight:900; cursor:pointer; }
    .tab-btn.active{ background:var(--p); color:white; border-color:var(--p); }
    .tab-pane{ display:none; text-align:left; font-size:14px; line-height:1.8; color:#444; }
    .tab-pane.active{ display:block; }

    #wechat-mask{
      display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.9); z-index:11000;
      align-items:center; justify-content:center; flex-direction:column; color:white;
    }

    #work-drawer{
      width:100%; max-width:420px; background:#2d3436; color:white;
      max-height:0; overflow:hidden; transition:0.5s;
      position:fixed; bottom:0; z-index:12000;
      border-radius:40px 40px 0 0;
    }

    .footer{ font-size:11px; color:#bbb; padding:12px; text-align:center; }

    .mode-delivery #admin-panel,
    .mode-delivery #work-drawer,
    .mode-delivery #gate-footer{ display:none !important; }
  </style>
</head>

<body class="warm-pink style-arch">
  <div id="admin-panel">
    <div class="picker-group">
      <div class="dot" onclick="setTheme('warm-pink')" style="background:#ee5253"></div>
      <div class="dot" onclick="setTheme('aurora-blue')" style="background:#00a8ff"></div>
      <div class="dot" onclick="setTheme('vivid-orange')" style="background:#f0932b"></div>
      <div class="dot" onclick="setTheme('royal-purple')" style="background:#6c5ce7"></div>
      <div class="dot" onclick="setTheme('teal-green')" style="background:#20bf6b"></div>
    </div>

    <div class="picker-group" style="margin-top:2px;">
      <span class="hint-bounce"><i class="fa-solid fa-hand-pointer"></i> é»é¸é¡è‰²ç‰ˆå‹åƒè€ƒ</span>
    </div>

    <div class="picker-group">
      <button class="btn-style active" onclick="setStyle('arch', this)">å„ªé›…æ‹±å‹</button>
      <button class="btn-style" onclick="setStyle('flat', this)">ç°¡æ½”å¹³ç›´</button>
      <button class="btn-style" onclick="setStyle('spot', this)">æ™¨æ›¦èšå…‰</button>
    </div>
  </div>

  <div id="card-container" class="card">
    <div class="banner"><div class="arch-overlay"></div></div>

    <div class="avatar-wrap">
      <img id="u-img" src="https://drive.google.com/thumbnail?id=18izl3Ym9zRDLtqe6zplRhB7mFjDA3tuB&sz=w1000" class="avatar" />
    </div>

    <div class="info-scroll">
      <h1 id="u-name" class="name">è®€å–ä¸­...</h1>
      <div id="u-unit" class="unit">å¹¸ç¦æ™ºæ…§æœå‹™ä¸­å¿ƒ</div>
      <div id="u-motto" class="motto" style="display:none;"></div>

      <div id="brand-logo" class="brand-logo-below"><img id="u-logo" alt="logo" /></div>

      <div class="social-bar">
        <a href="#" id="lk1" class="social-link" target="_blank" rel="noopener"></a>
        <a href="#" id="lk2" class="social-link" target="_blank" rel="noopener"></a>
        <a href="#" id="lk3" class="social-link" target="_blank" rel="noopener"></a>
      </div>

      <div id="share-box" class="content-box" style="background:#f0f7ff;border:1px solid #00a8ff;text-align:center;cursor:pointer;" onclick="handleShare()">
        <span id="share-label" class="label" style="color:#0097e6">ğŸ“¢ æ¨è–¦è£½ä½œæ™ºæ…§åç‰‡</span>
        <div style="font-weight:900;font-size:14px;color:#2d3436;"><i class="fa-solid fa-share-nodes"></i> é»æˆ‘è¤‡è£½ç¶²å€åˆ†äº«</div>
      </div>

      <div id="advantage-box" class="content-box">
        <span class="label" style="color:#6c5ce7;">ğŸ† ç‚ºä»€éº¼æ‚¨éœ€è¦æ™ºæ…§åç‰‡ï¼Ÿ</span>
        <div style="font-size:14px;color:#2d3436;margin-bottom:8px;">ä¸€éµåˆ†äº«ï¼šè¤‡è£½ç¶²å€ï¼Œå‚³æ’­å…¨ä¸–ç•Œ</div>
        <div style="font-size:14px;color:#2d3436;margin-bottom:8px;">å½±éŸ³æ•´åˆï¼šå€‹äºº YouTubeã€æŠ–éŸ³ ç­‰å¹³è‡ºå±•ç¤º</div>
        <div style="font-size:14px;color:#2d3436;">å…§å®¹æ›´æ–°ï¼šå¾Œå°æ›´æ–°ï¼ŒåŒæ­¥æ›´æ–°</div>
      </div>

      <div id="order-box" class="content-box" style="background:#fff9f9;border:1px dashed rgba(238,82,83,0.65);">
        <span class="label" style="color:#ee5253">ğŸ“ ç¬¬äºŒæ­¥ï¼šé ç´„è£½ä½œæ‚¨çš„æ™ºæ…§åç‰‡</span>
        <a href="https://forms.gle/dkeHW9tfEYiGx39U9" target="_blank" rel="noopener" style="color:#2d3436;text-decoration:none;font-weight:900;font-size:14px;">ç«‹å³å¡«å¯«é ç´„è¡¨å–® â†’</a>
      </div>

      <div class="content-box">
        <span class="label">æœå‹™é …ç›®</span>
        <div id="u-service" class="text" style="font-size:14.5px;color:#2d3436;line-height:1.6;white-space:pre-wrap;">è®€å–ä¸­...</div>
      </div>

      <div id="install-entry" class="bottom-guide-bar" style="display:none;">
        <button class="mini-install-btn" onclick="openInstallModal()">ğŸ“² å®‰è£åç‰‡ App æ•™å­¸</button>
      </div>
    </div>

    <div id="actions-area" class="actions">
      <div id="line-guide" class="line-guide">é»é€² line å®˜æ–¹ç¶²ç«™ï¼Œé ç´„è¨‚è£½åç‰‡</div>

      <a href="https://lin.ee/2ac9Roe" id="btn-oa" class="act-btn btn-main" target="_blank" rel="noopener">
        <span class="icon-bubble"><i class="fa-brands fa-line"></i></span>
        <span class="label-txt">LINE å®˜æ–¹å¸³è™Ÿ</span>
      </a>

      <a href="javascript:void(0)" id="btn-wechat" class="act-btn btn-wechat" onclick="showWechatText()">
        <span class="icon-bubble"><i class="fa-brands fa-weixin"></i></span>
        <span class="label-txt">å¾®ä¿¡è¯ç¹«</span>
      </a>

      <a href="mailto:a0973180707@gmail.com" id="btn-mail" class="act-btn btn-mail">
        <span class="icon-bubble"><i class="fa-solid fa-envelope"></i></span>
        <span class="label-txt">å¯„é€éƒµç®±</span>
      </a>

      <a href="https://line.me/ti/p/VqJzbWHm_4" id="btn-p" class="act-btn btn-sub" target="_blank" rel="noopener">
        <span class="icon-bubble"><i class="fa-solid fa-user-plus"></i></span>
        <span class="label-txt">LINE åŠ å¥½å‹</span>
      </a>
    </div>

    <!-- âœ… v339ï¼šéš±å½¢å¾Œå°ç†±å€ï¼ˆå¡ç‰‡å…§ä¸€å®šé»å¾—åˆ°ï¼‰ -->
    <div id="secret-gate" onclick="handleGate()"></div>
  </div>

  <div id="install-modal" onclick="closeInstallModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <span class="close-modal" onclick="closeInstallModal(event)">&times;</span>
      <h3 style="margin-top:0;color:var(--p);text-align:center;">å®‰è£åç‰‡æ•™å­¸</h3>

      <div style="background:#f8f9fa;padding:15px;border-radius:15px;text-align:center;margin-bottom:15px;">
        <button onclick="copyCurrentUrl()" style="background:var(--p);color:white;border:none;padding:8px 15px;border-radius:10px;font-weight:900;width:100%;">ğŸ”— è¤‡è£½ç¶²å€</button>
      </div>

      <div class="modal-tab">
        <button class="tab-btn active" onclick="switchTab('apple')">ğŸ iPhone</button>
        <button class="tab-btn" onclick="switchTab('android')">ğŸ¤– Android</button>
      </div>
      <div id="apple-pane" class="tab-pane active">1. é»æ“Š Safari ä¸‹æ–¹ [åˆ†äº«ç®­é ­ â¬†ï¸]<br>2. é¸æ“‡ [åŠ å…¥ä¸»ç•«é¢]</div>
      <div id="android-pane" class="tab-pane">1. é»æ“Š Chrome å³ä¸Šè§’ [ä¸‰å€‹é»é»]<br>2. é¸æ“‡ [å®‰è£æ‡‰ç”¨ç¨‹å¼]</div>
    </div>
  </div>

  <div id="wechat-mask" onclick="this.style.display='none'">
    <div style="background:white;color:#333;padding:30px;border-radius:30px;width:80%;max-width:320px;text-align:center;">
      <i class="fa-brands fa-weixin" style="font-size:50px;color:#07C160;margin-bottom:15px;"></i>
      <h3 style="margin:10px 0;">å¾®ä¿¡è¯ç¹« ID</h3>
      <p id="wechat-id-text" style="font-size:20px;font-weight:900;background:#f0f0f0;padding:10px;border-radius:10px;margin:15px 0;">ï¼ˆæœªæä¾›ï¼‰</p>
      <button onclick="copyWechat()" style="background:#07C160;color:white;border:none;padding:10px 20px;border-radius:10px;font-weight:900;width:100%;">é»æ“Šè¤‡è£½ ID</button>
    </div>
  </div>

  <div id="work-drawer">
    <div style="padding:25px;text-align:center;">
      <input type="text" id="work-id" style="width:90%;padding:15px;border-radius:15px;border:1px solid #ddd;color:#333;" placeholder="è¼¸å…¥åºè™Ÿæˆ–å§“å" />
      <button onclick="doPreviewInPlace()" style="background:#ee5253;color:white;width:90%;padding:15px;margin-top:10px;border-radius:15px;border:none;font-weight:900;">é è¦½æˆå“ï¼ˆä¸è·³å‡ºï¼‰</button>
      <button onclick="doCopy()" style="background:#2ecc71;color:white;width:90%;padding:15px;margin-top:10px;border-radius:15px;border:none;font-weight:900;">è¤‡è£½äº¤è²¨ç¶²å€</button>
    </div>
  </div>

  <div id="gate-footer" class="footer">Â© 2026 å¹¸ç¦æ™ºæ…§åç‰‡ V339</div>

  <script>
    const VERSION = 339;

    // âœ… v339ï¼šç›®å‰åç‰‡çš„å‹•æ…‹è³‡æ–™ï¼ˆçµ¦å¾®ä¿¡/LINE å³æ™‚ä½¿ç”¨ï¼‰
    let currentWechat = "";
    let currentLineOA = "";
    let currentLineP  = "";
    let currentEmail  = "";
    let currentPhone  = "";

    const LS_THEME = 'angel_card_theme';
    const LS_STYLE = 'angel_card_style';

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js?v=' + VERSION).catch(() => {});
      });
    }

    const urlParams = new URLSearchParams(window.location.search);
    const urlId = urlParams.get('id');

    let allRows = [];
    let clicks = 0;

    let curTheme = urlParams.get('theme') || localStorage.getItem(LS_THEME) || 'warm-pink';
    let curStyle = urlParams.get('style') || localStorage.getItem(LS_STYLE) || 'arch';

    let uiMain = !urlId;

    function openInstallModal(){ document.getElementById('install-modal').style.display = 'flex'; }
    function closeInstallModal(e){ document.getElementById('install-modal').style.display = 'none'; }
    function switchTab(type){
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
      if(type === 'apple'){
        document.querySelectorAll('.tab-btn')[0].classList.add('active');
        document.getElementById('apple-pane').classList.add('active');
      } else {
        document.querySelectorAll('.tab-btn')[1].classList.add('active');
        document.getElementById('android-pane').classList.add('active');
      }
    }

    async function safeCopy(text){
      try{
        if(navigator.clipboard && window.isSecureContext){
          await navigator.clipboard.writeText(text);
          return true;
        }
      }catch(e){}
      try{
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.setAttribute('readonly','');
        ta.style.position = 'fixed';
        ta.style.top = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        ta.setSelectionRange(0, ta.value.length);
        const ok = document.execCommand('copy');
        document.body.removeChild(ta);
        return ok;
      }catch(e){
        return false;
      }
    }

    async function copyCurrentUrl(){
      const ok = await safeCopy(window.location.href);
      alert(ok ? "ç¶²å€å·²è¤‡è£½ï¼" : "æ­¤ç€è¦½å™¨é™åˆ¶è¤‡è£½ï¼Œè«‹é•·æŒ‰ç¶²å€åˆ—è¤‡è£½");
    }

    // âœ… v339ï¼šå¾®ä¿¡æŒ‰ä¸‹å»æ‰å³æ™‚å¡«å…¥ï¼Œé¿å…ç©ºç™½
    function showWechatText(){
      const id = (currentWechat || "").trim();
      if(!id){
        alert("æ­¤åç‰‡æœªæä¾›å¾®ä¿¡ ID");
        return;
      }
      document.getElementById('wechat-id-text').innerText = id;
      document.getElementById('wechat-mask').style.display = 'flex';
    }

    async function copyWechat(){
      const txt = document.getElementById('wechat-id-text').innerText.trim();
      if(!txt || txt === "ï¼ˆæœªæä¾›ï¼‰"){
        alert("æ­¤åç‰‡æœªæä¾›å¾®ä¿¡ ID");
        return;
      }
      const ok = await safeCopy(txt);
      alert(ok ? "å¾®ä¿¡ ID å·²è¤‡è£½ï¼" : "æ­¤ç€è¦½å™¨é™åˆ¶è¤‡è£½ï¼Œè«‹æ‰‹å‹•è¤‡è£½");
    }

    function setTheme(t){
      curTheme = t;
      localStorage.setItem(LS_THEME, t);
      updateClass();
    }
    function setStyle(s, btn){
      curStyle = s;
      localStorage.setItem(LS_STYLE, s);
      updateClass();
      if(btn){
        document.querySelectorAll('.btn-style').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      }
    }

    function updateClass(){
      document.body.className = `${curTheme} style-${curStyle}${uiMain ? ' mode-main' : ' mode-delivery'}`;
      const meta = document.querySelector('meta[name="theme-color"]');
      if (meta) meta.setAttribute('content', getComputedStyle(document.documentElement).getPropertyValue('--p').trim() || '#ee5253');
    }

    // âœ… v339ï¼šå¾Œå°å…¥å£æ”¹æˆå¡ç‰‡å…§ secret-gateï¼ˆé€£é» 3 ä¸‹ï¼‰
    function handleGate(){
      if(!uiMain) return;
      clicks++;
      if(clicks >= 3){
        document.getElementById('work-drawer').style.maxHeight = '500px';
        clicks = 0;
      }
      setTimeout(() => clicks = 0, 900);
    }

    async function handleShare(){
      const ok = await safeCopy(window.location.href);
      alert(ok ? "é€£çµè¤‡è£½æˆåŠŸï¼" : "æ­¤ç€è¦½å™¨é™åˆ¶è¤‡è£½ï¼Œè«‹é•·æŒ‰ç¶²å€åˆ—è¤‡è£½");
    }

    function fixImg(url){
      if(!url) return "";
      const idMatch = url.match(/id=([-\w]+)/) || url.match(/d\/([-\w]+)/);
      return idMatch ? `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w1000` : url;
    }

    function parseCSV(text){
      const rows = [];
      let row = [];
      let cur = '';
      let i = 0;
      let inQuotes = false;

      while(i < text.length){
        const ch = text[i];

        if(inQuotes){
          if(ch === '"'){
            const next = text[i+1];
            if(next === '"'){ cur += '"'; i += 2; continue; }
            inQuotes = false; i++; continue;
          }
          cur += ch; i++; continue;
        }else{
          if(ch === '"'){ inQuotes = true; i++; continue; }
          if(ch === ','){ row.push(cur.trim()); cur=''; i++; continue; }
          if(ch === '\n' || ch === '\r'){
            if(ch === '\r' && text[i+1] === '\n') i++;
            row.push(cur.trim()); cur='';
            if(row.some(c => c !== '')) rows.push(row);
            row = []; i++; continue;
          }
          cur += ch; i++; continue;
        }
      }
      row.push(cur.trim());
      if(row.some(c => c !== '')) rows.push(row);
      return rows;
    }

    async function loadSheetData(){
      const csvUrl = "https://docs.google.com/spreadsheets/d/16c21SGmuUVpKVnUrCvWt88OWZdepI76hawWW3DvNJMY/export?format=csv&gid=1350316682&t=" + Date.now();
      try{
        const res = await fetch(csvUrl);
        const text = await res.text();
        allRows = parseCSV(text);
      } catch(e){
        console.log("è³‡æ–™åŒæ­¥ä¸­");
      }
    }

    // âœ… v339ï¼šLINE é€£çµåˆ¤æ–·ï¼ˆä¸å†åªåƒ httpï¼‰
    const isLineLink = (v) => {
      const s = String(v || "").trim();
      if(!s) return false;
      const low = s.toLowerCase();
      return (
        low.startsWith('http://') ||
        low.startsWith('https://') ||
        low.startsWith('line://') ||
        low.includes('lin.ee') ||
        low.includes('line.me') ||
        low.includes('liff.line.me') ||
        low.includes('line.biz') ||
        low.includes('openchat.line.me')
      );
    };

    const normalizeMaybeUrl = (v) => {
      const s = String(v || "").trim();
      if(!s) return "";
      // è‹¥æ˜¯ lin.ee æ²’æœ‰ httpï¼Œè£œä¸Š https
      if(s.toLowerCase().startsWith('lin.ee/')) return 'https://' + s;
      if(s.toLowerCase().startsWith('line.me/')) return 'https://' + s;
      return s;
    };

    function renderMainFixedFirstRow(){
      if(!allRows[0] || !allRows[1]) return;
      applyRow(allRows[0], allRows[1], { isMainData:true, keepUiMain:true });
    }

    function renderById(keyword, keepUiMain){
      if(!keyword || !allRows[0]) return false;
      const h = allRows[0];
      const d = allRows.find((r, idx) => idx !== 0 && (r[0] == keyword || r[1] == keyword));
      if(!d) return false;
      applyRow(h, d, { isMainData:false, keepUiMain: !!keepUiMain });
      return true;
    }

    function doPreviewInPlace(){
      const id = (document.getElementById('work-id').value || "").trim();
      if(!id){ alert("è«‹å…ˆè¼¸å…¥åºè™Ÿæˆ–å§“å"); return; }
      const ok = renderById(id, true);
      if(!ok){ alert("æ‰¾ä¸åˆ°æ­¤åºè™Ÿ/å§“å"); return; }
      document.querySelector('.info-scroll')?.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function applyRow(h, d, opt){
      const isMainData = !!(opt && opt.isMainData);
      const keepUiMain = !!(opt && opt.keepUiMain);

      uiMain = keepUiMain ? true : !urlId;
      updateClass();

      const getVal = (key) => {
        const idx = h.findIndex(head => (head || "").includes(key));
        return (idx !== -1 && d[idx]) ? d[idx] : "";
      };

      const name   = getVal('å§“å');
      const unit   = getVal('å–®ä½') || getVal('å–®ä½åç¨±');
      const motto  = getVal('ç†å¿µæ¨™èª');
      const service= getVal('æœå‹™é …ç›®') || getVal('æœå‹™');
      const avatar = fixImg(getVal('å€‹äººå°ˆæ¥­å½¢è±¡ç…§') || getVal('å½¢è±¡ç…§'));
      const logo   = fixImg(getVal('å“ç‰Œ Logo') || getVal('å“ç‰ŒLogo') || getVal('Logo'));

      const wechat = getVal('å¾®ä¿¡') || getVal('å¾®ä¿¡ ID');
      const email  = getVal('ä¸€éµè¯ç¹« Email') || getVal('Email') || getVal('éƒµç®±');
      const phone  = getVal('ä¸€éµè¯ç¹«é›»è©±') || getVal('é›»è©±');
      const lineP  = getVal('ç§è¨Š LINE') || getVal('LINE åŠ å¥½å‹') || getVal('å€‹äººå¥½å‹');
      const lineOA = getVal('LINE å®˜æ–¹') || getVal('å®˜æ–¹å¸³è™Ÿ');

      // âœ… v339ï¼šå­˜æˆç›®å‰åç‰‡çš„è³‡æ–™ï¼Œçµ¦é»æ“Šæ™‚ä½¿ç”¨
      currentWechat = String(wechat || "").trim();
      currentLineOA = String(lineOA || "").trim();
      currentLineP  = String(lineP  || "").trim();
      currentEmail  = String(email || "").trim();
      currentPhone  = String(phone || "").trim();

      document.getElementById('u-name').innerText = name || "ï¼ˆæœªå¡«å§“åï¼‰";
      document.getElementById('u-unit').innerText = unit || "ï¼ˆæœªå¡«å–®ä½ï¼‰";
      document.getElementById('u-service').innerText = service || "ï¼ˆæœªå¡«æœå‹™é …ç›®ï¼‰";
      document.getElementById('u-img').src = avatar || "https://drive.google.com/thumbnail?id=18izl3Ym9zRDLtqe6zplRhB7mFjDA3tuB&sz=w1000";

      const mottoEl = document.getElementById('u-motto');
      if(motto){ mottoEl.style.display=''; mottoEl.innerText=motto; }
      else { mottoEl.style.display='none'; mottoEl.innerText=''; }

      const logoWrap = document.getElementById('brand-logo');
      const logoImg  = document.getElementById('u-logo');
      if(logo){
        logoImg.src = logo;
        logoWrap.style.display = 'flex';
      } else {
        logoImg.src = '';
        logoWrap.style.display = 'none';
      }

      // âœ… ä¸»é  / äº¤è²¨é é¡¯ç¤ºè¦å‰‡
      if(isMainData){
        document.getElementById('advantage-box').style.display = 'block';
        document.getElementById('order-box').style.display = 'block';
        document.getElementById('install-entry').style.display = 'none';
        document.getElementById('line-guide').style.display = 'block';
      } else {
        document.getElementById('advantage-box').style.display = 'none';
        document.getElementById('order-box').style.display = 'none';
        document.getElementById('install-entry').style.display = 'block';
        document.getElementById('line-guide').style.display = uiMain ? 'block' : 'none';
      }

      // âœ… v339ï¼šæŒ‰éˆ•é€£çµæ›´æ–°ï¼ˆä¸å†åªåƒ httpï¼‰
      const btnOA = document.getElementById('btn-oa');
      const btnP  = document.getElementById('btn-p');
      const btnMail = document.getElementById('btn-mail');
      const btnWechat = document.getElementById('btn-wechat');

      if(isMainData){
        // ä¸»é å›ºå®šå®˜æ–¹è³‡è¨Šï¼ˆä½ åŸæœ¬é‚£çµ„ï¼‰
        btnOA.style.display = 'flex';
        btnOA.href = "https://lin.ee/2ac9Roe";
        btnP.style.display = 'flex';
        btnP.href  = "https://line.me/ti/p/VqJzbWHm_4";
        btnMail.style.display = 'flex';
        btnMail.href = "mailto:a0973180707@gmail.com";
        btnWechat.style.display = 'flex';
        currentWechat = currentWechat || "a0973180707"; // ä¸»é è‡³å°‘æœ‰å€¼
      } else {
        // äº¤è²¨é ä¾åç‰‡è³‡æ–™
        if(isLineLink(currentLineOA)){
          btnOA.style.display = 'flex';
          btnOA.href = normalizeMaybeUrl(currentLineOA);
        } else {
          btnOA.style.display = 'none';
        }

        if(isLineLink(currentLineP)){
          btnP.style.display = 'flex';
          btnP.href = normalizeMaybeUrl(currentLineP);
        } else {
          btnP.style.display = 'none';
        }

        if(currentEmail){
          btnMail.style.display = 'flex';
          btnMail.href = `mailto:${currentEmail}`;
        } else {
          btnMail.style.display = 'none';
        }

        // å¾®ä¿¡ï¼šæœ‰å¡«æ‰é¡¯ç¤º
        btnWechat.style.display = currentWechat ? 'flex' : 'none';
      }
    }

    async function doCopy(){
      const id = (document.getElementById('work-id').value || "").trim();
      if(!id){ alert("è«‹å…ˆè¼¸å…¥åºè™Ÿæˆ–å§“å"); return; }
      const finalUrl = `${window.location.origin}${window.location.pathname}?id=${encodeURIComponent(id)}&theme=${encodeURIComponent(curTheme)}&style=${encodeURIComponent(curStyle)}`;
      const ok = await safeCopy(finalUrl);
      alert(ok ? "âœ… äº¤è²¨ç¶²å€å·²è¤‡è£½ï¼ï¼ˆå·²å¸¶é¡è‰²/ç‰ˆå‹ï¼‰" : "æ­¤ç€è¦½å™¨é™åˆ¶è¤‡è£½ï¼Œè«‹æ‰‹å‹•è¤‡è£½ç¶²å€åˆ—");
    }

    let _inited = false;
    async function init(){
      if(_inited) return;
      _inited = true;

      await loadSheetData();

      if(urlId){
        uiMain = false;
        const ok = renderById(urlId, false);
        if(!ok){
          uiMain = true;
          renderMainFixedFirstRow();
        }
      } else {
        uiMain = true;
        renderMainFixedFirstRow();
      }

      document.querySelectorAll('.btn-style').forEach(b => b.classList.remove('active'));
      const mapBtn = { arch:0, flat:1, spot:2 };
      const idx = mapBtn[curStyle] ?? 0;
      const btns = document.querySelectorAll('.btn-style');
      if(btns[idx]) btns[idx].classList.add('active');

      updateClass();
    }
    init();
  </script>
</body>
</html>