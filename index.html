<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>å¤©ä½¿å¹¸ç¦æ™ºæ…§åç‰‡ V335</title>

  <link rel="manifest" href="./manifest.json?v=335" />
  <meta name="theme-color" content="#ee5253" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet" />

  <style>
    :root { --p:#ee5253; --s:#d63031; --bg:#f5f6fa; }
    .warm-pink { --p:#ee5253; --s:#d63031; }
    .aurora-blue { --p:#00a8ff; --s:#0097e6; }
    .vivid-orange { --p:#f0932b; --s:#eb4d4b; }
    .royal-purple { --p:#6c5ce7; --s:#4834d4; }
    .teal-green { --p:#20bf6b; --s:#0b8d51; }

    body{
      font-family:'Noto Sans TC',sans-serif;
      margin:0;
      background:var(--bg);
      display:flex;
      flex-direction:column;
      align-items:center;
      min-height:100vh;
    }

    #admin-panel{
      width:100%;
      background:white;
      text-align:center;
      padding:15px 0 10px;
      border-bottom:1px solid #ddd;
      z-index:2000;
      flex-shrink:0;
    }
    .picker-group{ display:flex; justify-content:center; gap:12px; margin-bottom:8px; align-items:center; }
    .dot{
      width:32px;height:32px;border-radius:50%;
      cursor:pointer;border:3px solid white;
      box-shadow:0 4px 10px rgba(0,0,0,0.15);
    }
    .btn-style{
      padding:6px 14px;border-radius:20px;border:1px solid #ccc;
      font-size:11px;cursor:pointer;background:#fff;font-weight:900;
    }
    .btn-style.active{ background:#2f3640!important; color:white!important; }

    .hint-bounce{
      font-size:12px;
      font-weight:900;
      color:#2d3436;
      opacity:0.9;
      letter-spacing:0.5px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      user-select:none;
      animation: hintFloat 1.2s ease-in-out infinite;
    }
    .hint-bounce i{ color:var(--p); }
    @keyframes hintFloat{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-3px); }
    }

    .card{
      background:white;
      width:92%;
      max-width:380px;
      height:680px;
      border-radius:45px;
      overflow:hidden;
      box-shadow:0 30px 60px rgba(0,0,0,0.15);
      position:relative;
      margin:20px 0;
      display:flex;
      flex-direction:column;
    }

    .banner{
      height:160px;
      background:linear-gradient(135deg,var(--p),var(--s));
      flex-shrink:0;
      position:relative;
    }
    .arch-overlay{
      position:absolute;width:100%;height:90px;background:white;
      bottom:-1px;border-radius:90px 90px 0 0;
    }
    .style-flat .arch-overlay{ border-radius:0; height:35px; }
    .style-spot .arch-overlay{ border-radius:50% 50% 0 0; transform:scaleX(1.4); height:100px; }

    .avatar-wrap{
      width:130px;height:130px;background:#fff;border-radius:50%;
      padding:6px;box-shadow:0 10px 25px rgba(0,0,0,0.1);
      position:absolute;top:35px;left:50%;transform:translateX(-50%);
      z-index:100;
    }
    .avatar{ width:100%;height:100%;border-radius:50%;object-fit:cover; }

    .mode-main .avatar-wrap{ border-radius:50%; }
    .mode-main .avatar{ border-radius:50%; }

    .info-scroll{
      flex:1; overflow-y:auto; padding:45px 20px 0; text-align:center;
      scrollbar-width:none;
    }
    .info-scroll::-webkit-scrollbar{ display:none; }

    .name{ font-size:26px; font-weight:900; color:#2d3436; margin:5px 0; }
    .unit{ font-size:14px; color:var(--s); font-weight:700; margin-bottom:6px; }

    .motto{
      font-size:13px;color:#2d3436;opacity:0.9;font-weight:700;
      margin:0 0 8px;line-height:1.5;
    }

    .brand-logo-below{
      width:52px;height:52px;border-radius:16px;
      background:rgba(255,255,255,0.95);
      display:none; align-items:center; justify-content:center;
      overflow:hidden;
      box-shadow:0 10px 18px rgba(0,0,0,0.10);
      border:1px solid rgba(0,0,0,0.06);
      margin:8px auto 8px;
    }
    .brand-logo-below img{ width:100%;height:100%;object-fit:cover; }

    .social-bar{ display:flex; justify-content:center; align-items:center; gap:15px; margin:15px 0 20px; }
    .social-link{
      width:45px;height:45px;border-radius:12px;background:#fff;
      display:none; align-items:center; justify-content:center;
      text-decoration:none;font-size:20px;color:var(--s);
      box-shadow:4px 4px 10px rgba(0,0,0,0.06);
    }

    .content-box{
      text-align:left;background:#ffffff;padding:18px;border-radius:25px;
      margin-bottom:15px;
      box-shadow:10px 10px 20px rgba(0,0,0,0.03);
      border:1px solid #f9f9f9;
    }
    .label{ color:#adb5bd;font-weight:900;font-size:11px;margin-bottom:8px;display:block; }

    .img-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
    .img-grid a{ display:block; }
    .img-grid img{
      width:100%; height:78px; object-fit:cover; border-radius:14px;
      border:1px solid #eee; background:#f7f7f7;
    }

    .faq-item{ background:#fafafa;border:1px solid #eee;border-radius:16px;padding:12px 12px;margin-top:10px; }
    .faq-q{ font-weight:900;color:#2d3436;font-size:13px;margin-bottom:6px; }
    .faq-a{ color:#2d3436;font-size:13px;line-height:1.7;white-space:pre-wrap; }

    .bottom-guide-bar{ padding:5px 0 20px; text-align:center; }
    .mini-install-btn{
      background:#fff; color:var(--p); border:1.5px solid var(--p);
      padding:6px 15px; border-radius:50px; font-size:12px; font-weight:900;
      cursor:pointer;
    }

    .actions{
      background:white;
      padding:15px 20px 25px;
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
      flex-shrink:0;
      border-top:1px solid #eee;
    }
    .act-btn{
      text-decoration:none;
      background:#f1f2f6;
      padding:12px;
      border-radius:15px;
      color:#2f3542;
      font-size:13px;
      font-weight:900;
      text-align:center;
      border:1px solid #e1e2e6;
      display:block;
    }
    .btn-main{
      background:linear-gradient(145deg,#06C755,#05af4b)!important;
      color:white!important;
      grid-column:span 2;
      border:none;
    }
    .btn-sub{
      background:#ffffff!important;
      color:#06C755!important;
      border:2px solid #06C755!important;
    }

    .line-guide{
      grid-column: span 2;
      background: #f7fff9;
      border: 1px solid rgba(6,199,85,0.25);
      color: #1f7a46;
      font-size: 12px;
      font-weight: 900;
      padding: 10px 12px;
      border-radius: 14px;
      text-align: center;
      display: none;
    }

    #install-modal{
      display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.85); z-index:10000;
      align-items:center; justify-content:center; padding:20px;
    }
    .modal-content{ background:white; width:100%; max-width:320px; border-radius:35px; padding:25px; position:relative; }
    .close-modal{ position:absolute; top:15px; right:20px; font-size:24px; color:#999; cursor:pointer; }
    .modal-tab{ display:flex; gap:8px; margin:15px 0; }
    .tab-btn{ flex:1; padding:8px; border-radius:10px; border:1px solid #ddd; background:#f8f9fa; font-size:12px; font-weight:900; cursor:pointer; }
    .tab-btn.active{ background:var(--p); color:white; border-color:var(--p); }
    .tab-pane{ display:none; text-align:left; font-size:14px; line-height:1.8; color:#444; }
    .tab-pane.active{ display:block; }

    #wechat-mask{
      display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.9); z-index:11000;
      align-items:center; justify-content:center; flex-direction:column; color:white;
    }

    #work-drawer{
      width:100%; max-width:420px; background:#2d3436; color:white;
      max-height:0; overflow:hidden; transition:0.5s;
      position:fixed; bottom:0; z-index:12000;
      border-radius:40px 40px 0 0;
    }
    .footer{ font-size:11px; color:#bbb; padding:25px; cursor:pointer; text-align:center; }

    .mode-delivery #admin-panel,
    .mode-delivery #work-drawer,
    .mode-delivery #gate-footer{ display:none !important; }
  </style>
</head>

<body class="warm-pink style-arch">
  <div id="admin-panel">
    <div class="picker-group">
      <div class="dot" onclick="setTheme('warm-pink')" style="background:#ee5253"></div>
      <div class="dot" onclick="setTheme('aurora-blue')" style="background:#00a8ff"></div>
      <div class="dot" onclick="setTheme('vivid-orange')" style="background:#f0932b"></div>
      <div class="dot" onclick="setTheme('royal-purple')" style="background:#6c5ce7"></div>
      <div class="dot" onclick="setTheme('teal-green')" style="background:#20bf6b"></div>
    </div>

    <div class="picker-group" style="margin-top:2px;">
      <span class="hint-bounce"><i class="fa-solid fa-hand-pointer"></i> é»é¸é¡è‰²ç‰ˆå‹åƒè€ƒ</span>
    </div>

    <div class="picker-group">
      <button class="btn-style active" onclick="setStyle('arch', this)">å„ªé›…æ‹±å‹</button>
      <button class="btn-style" onclick="setStyle('flat', this)">ç°¡æ½”å¹³ç›´</button>
      <button class="btn-style" onclick="setStyle('spot', this)">æ™¨æ›¦èšå…‰</button>
    </div>
  </div>

  <div id="card-container" class="card">
    <div class="banner"><div class="arch-overlay"></div></div>

    <div class="avatar-wrap">
      <img id="u-img" src="https://drive.google.com/thumbnail?id=18izl3Ym9zRDLtqe6zplRhB7mFjDA3tuB&sz=w1000" class="avatar" />
    </div>

    <div class="info-scroll">
      <h1 id="u-name" class="name">è®€å–ä¸­...</h1>
      <div id="u-unit" class="unit">å¹¸ç¦æ™ºæ…§æœå‹™ä¸­å¿ƒ</div>
      <div id="u-motto" class="motto" style="display:none;"></div>

      <div id="brand-logo" class="brand-logo-below"><img id="u-logo" alt="logo" /></div>

      <div class="social-bar">
        <a href="#" id="lk1" class="social-link" target="_blank"></a>
        <a href="#" id="lk2" class="social-link" target="_blank"></a>
        <a href="#" id="lk3" class="social-link" target="_blank"></a>
      </div>

      <div id="share-box" class="content-box" style="background:#f0f7ff;border:1px solid #00a8ff;text-align:center;cursor:pointer;" onclick="handleShare()">
        <span id="share-label" class="label" style="color:#0097e6">ğŸ“¢ æ¨è–¦è£½ä½œæ™ºæ…§åç‰‡</span>
        <div style="font-weight:900;font-size:14px;color:#2d3436;"><i class="fa-solid fa-share-nodes"></i> é»æˆ‘è¤‡è£½ç¶²å€åˆ†äº«</div>
      </div>

      <div id="advantage-box" class="content-box">
        <span class="label" style="color:#6c5ce7;">ğŸ† ç‚ºä»€éº¼æ‚¨éœ€è¦æ™ºæ…§åç‰‡ï¼Ÿ</span>
        <div style="font-size:14px;color:#2d3436;margin-bottom:8px;">ä¸€éµåˆ†äº«ï¼šè¤‡è£½ç¶²å€ï¼Œå‚³æ’­å…¨ä¸–ç•Œ</div>
        <div style="font-size:14px;color:#2d3436;margin-bottom:8px;">å½±éŸ³æ•´åˆï¼šå€‹äºº YouTubeã€æŠ–éŸ³ ç­‰å¹³è‡ºå±•ç¤º</div>
        <div style="font-size:14px;color:#2d3436;">å…§å®¹æ›´æ–°ï¼šå¾Œå°æ›´æ–°ï¼ŒåŒæ­¥æ›´æ–°</div>
      </div>

      <div id="order-box" class="content-box" style="background:#fff9f9;border:1px dashed #ee5253;">
        <span class="label" style="color:#ee5253">ğŸ“ ç¬¬äºŒæ­¥ï¼šé ç´„è£½ä½œæ‚¨çš„æ™ºæ…§åç‰‡</span>
        <a href="https://forms.gle/dkeHW9tfEYiGx39U9" target="_blank" style="color:#2d3436;text-decoration:none;font-weight:900;font-size:14px;">ç«‹å³å¡«å¯«é ç´„è¡¨å–® â†’</a>
      </div>

      <div id="photos-box" class="content-box" style="display:none;">
        <span class="label">å“ç‰Œ / ç”¢å“ç…§ç‰‡</span>
        <div class="img-grid">
          <a id="p1a" href="#" target="_blank" style="display:none;"><img id="p1" alt="photo1" /></a>
          <a id="p2a" href="#" target="_blank" style="display:none;"><img id="p2" alt="photo2" /></a>
          <a id="p3a" href="#" target="_blank" style="display:none;"><img id="p3" alt="photo3" /></a>
        </div>
      </div>

      <div class="content-box">
        <span class="label">æœå‹™é …ç›®</span>
        <div id="u-service" class="text" style="font-size:14.5px;color:#2d3436;line-height:1.6;white-space:pre-wrap;">è®€å–ä¸­...</div>
      </div>

      <div id="titles-box" class="content-box" style="display:none;">
        <span class="label">é‡è¦é ­éŠœ / çéŠœ</span>
        <div id="u-titles" style="font-size:14.5px;color:#2d3436;line-height:1.7;white-space:pre-wrap;"></div>
      </div>

      <div id="faq-box" class="content-box" style="display:none;">
        <span class="label">å¸¸è¦‹æå•</span>
        <div id="faq-1" class="faq-item" style="display:none;">
          <div id="q1" class="faq-q"></div>
          <div id="a1" class="faq-a"></div>
        </div>
        <div id="faq-2" class="faq-item" style="display:none;">
          <div id="q2" class="faq-q"></div>
          <div id="a2" class="faq-a"></div>
        </div>
      </div>

      <div id="install-entry" class="bottom-guide-bar" style="display:none;">
        <button class="mini-install-btn" onclick="openInstallModal()">ğŸ“² å®‰è£åç‰‡ App æ•™å­¸</button>
      </div>
    </div>

    <div id="actions-area" class="actions">
      <div id="line-guide" class="line-guide">é»é€² line å®˜æ–¹ç¶²ç«™ï¼Œé ç´„è¨‚è£½åç‰‡</div>

      <a href="https://lin.ee/2ac9Roe" id="btn-oa" class="act-btn btn-main" target="_blank">âœ… LINE å®˜æ–¹å¸³è™Ÿ</a>
      <a href="javascript:void(0)" id="btn-wechat" class="act-btn" onclick="showWechatText()">ğŸ’¬ å¾®ä¿¡è¯ç¹«</a>
      <a href="mailto:a0973180707@gmail.com" id="btn-mail" class="act-btn">âœ‰ï¸ å¯„é€éƒµç®±</a>
      <a href="https://line.me/ti/p/VqJzbWHm_4" id="btn-p" class="act-btn btn-sub" target="_blank">ğŸ‘¤ LINE åŠ å¥½å‹</a>
    </div>
  </div>

  <div id="install-modal" onclick="closeInstallModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <span class="close-modal" onclick="closeInstallModal(event)">&times;</span>
      <h3 style="margin-top:0;color:var(--p);text-align:center;">å®‰è£åç‰‡æ•™å­¸</h3>

      <div style="background:#f8f9fa;padding:15px;border-radius:15px;text-align:center;margin-bottom:15px;">
        <button onclick="copyCurrentUrl()" style="background:var(--p);color:white;border:none;padding:8px 15px;border-radius:10px;font-weight:900;width:100%;">ğŸ”— è¤‡è£½ç¶²å€</button>
      </div>

      <div class="modal-tab">
        <button class="tab-btn active" onclick="switchTab('apple')">ğŸ iPhone</button>
        <button class="tab-btn" onclick="switchTab('android')">ğŸ¤– Android</button>
      </div>
      <div id="apple-pane" class="tab-pane active">1. é»æ“Š Safari ä¸‹æ–¹ [åˆ†äº«ç®­é ­ â¬†ï¸]<br>2. é¸æ“‡ [åŠ å…¥ä¸»ç•«é¢]</div>
      <div id="android-pane" class="tab-pane">1. é»æ“Š Chrome å³ä¸Šè§’ [ä¸‰å€‹é»é»]<br>2. é¸æ“‡ [å®‰è£æ‡‰ç”¨ç¨‹å¼]</div>
    </div>
  </div>

  <div id="wechat-mask" onclick="this.style.display='none'">
    <div style="background:white;color:#333;padding:30px;border-radius:30px;width:80%;max-width:320px;text-align:center;">
      <i class="fa-brands fa-weixin" style="font-size:50px;color:#07C160;margin-bottom:15px;"></i>
      <h3 style="margin:10px 0;">å¾®ä¿¡è¯ç¹« ID</h3>
      <p id="wechat-id-text" style="font-size:20px;font-weight:900;background:#f0f0f0;padding:10px;border-radius:10px;margin:15px 0;">a0973180707</p>
      <button onclick="copyWechat()" style="background:#07C160;color:white;border:none;padding:10px 20px;border-radius:10px;font-weight:900;width:100%;">é»æ“Šè¤‡è£½ ID</button>
    </div>
  </div>

  <div id="work-drawer">
    <div style="padding:25px;text-align:center;">
      <input type="text" id="work-id" style="width:90%;padding:15px;border-radius:15px;border:1px solid #ddd;color:#333;" placeholder="è¼¸å…¥åºè™Ÿæˆ–å§“å" />
      <button onclick="doPreviewInPlace()" style="background:#ee5253;color:white;width:90%;padding:15px;margin-top:10px;border-radius:15px;border:none;font-weight:900;">é è¦½æˆå“ï¼ˆä¸è·³å‡ºï¼‰</button>
      <button onclick="doCopy()" style="background:#2ecc71;color:white;width:90%;padding:15px;margin-top:10px;border-radius:15px;border:none;font-weight:900;">è¤‡è£½äº¤è²¨ç¶²å€</button>
    </div>
  </div>

  <div id="gate-footer" class="footer" onclick="handleGate()">Â© 2026 å¹¸ç¦æ™ºæ…§åç‰‡ V335</div>

  <script>
    const VERSION = 335;

    // âœ…ã€V335ã€‘è¨˜ä½ä½ åœ¨å‰è‡ºæ›¿å®¢æˆ¶é¸çš„é¡è‰²/ç‰ˆå‹ï¼ˆé‡æ•´ä¹Ÿä¸æœƒè·‘æ‰ï¼‰
    const LS_THEME = 'angel_card_theme';
    const LS_STYLE = 'angel_card_style';

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js?v=' + VERSION).catch(() => {});
      });
    }

    const urlParams = new URLSearchParams(window.location.search);
    const urlId = urlParams.get('id');

    let allRows = [];
    let clicks = 0;

    // âœ… å„ªå…ˆé †åºï¼šURL > localStorage > é è¨­
    let curTheme = urlParams.get('theme') || localStorage.getItem(LS_THEME) || 'warm-pink';
    let curStyle = urlParams.get('style') || localStorage.getItem(LS_STYLE) || 'arch';

    let uiMain = !urlId;

    function openInstallModal(){ document.getElementById('install-modal').style.display = 'flex'; }
    function closeInstallModal(e){ document.getElementById('install-modal').style.display = 'none'; }
    function switchTab(type){
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
      if(type === 'apple'){
        document.querySelectorAll('.tab-btn')[0].classList.add('active');
        document.getElementById('apple-pane').classList.add('active');
      } else {
        document.querySelectorAll('.tab-btn')[1].classList.add('active');
        document.getElementById('android-pane').classList.add('active');
      }
    }

    async function safeCopy(text){
      try{
        if(navigator.clipboard && window.isSecureContext){
          await navigator.clipboard.writeText(text);
          return true;
        }
      }catch(e){}
      try{
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.setAttribute('readonly','');
        ta.style.position = 'fixed';
        ta.style.top = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        ta.setSelectionRange(0, ta.value.length);
        const ok = document.execCommand('copy');
        document.body.removeChild(ta);
        return ok;
      }catch(e){
        return false;
      }
    }

    async function copyCurrentUrl(){
      const ok = await safeCopy(window.location.href);
      alert(ok ? "ç¶²å€å·²è¤‡è£½ï¼" : "æ­¤ç€è¦½å™¨é™åˆ¶è¤‡è£½ï¼Œè«‹é•·æŒ‰ç¶²å€åˆ—è¤‡è£½");
    }

    function showWechatText(){ document.getElementById('wechat-mask').style.display = 'flex'; }
    async function copyWechat(){
      const ok = await safeCopy(document.getElementById('wechat-id-text').innerText);
      alert(ok ? "å¾®ä¿¡ ID å·²è¤‡è£½ï¼" : "æ­¤ç€è¦½å™¨é™åˆ¶è¤‡è£½ï¼Œè«‹æ‰‹å‹•è¤‡è£½");
    }

    // âœ…ã€V335ã€‘é¸å®Œå°±ç«‹åˆ»è¨˜ä½ï¼ˆä½ å‰è‡ºé¸å¥½ï¼Œå¾Œè‡ºåªè¼¸å…¥å§“åå°±å¥½ï¼‰
    function setTheme(t){
      curTheme = t;
      localStorage.setItem(LS_THEME, t);
      updateClass();
    }
    function setStyle(s, btn){
      curStyle = s;
      localStorage.setItem(LS_STYLE, s);
      updateClass();
      if(btn){
        document.querySelectorAll('.btn-style').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      }
    }

    function updateClass(){
      document.body.className = `${curTheme} style-${curStyle}${uiMain ? ' mode-main' : ' mode-delivery'}`;
      const meta = document.querySelector('meta[name="theme-color"]');
      if (meta) meta.setAttribute('content', getComputedStyle(document.documentElement).getPropertyValue('--p').trim() || '#ee5253');
    }

    function handleGate(){
      if(!uiMain) return;
      clicks++;
      if(clicks >= 3){
        document.getElementById('work-drawer').style.maxHeight = '500px';
        clicks = 0;
      }
      setTimeout(() => clicks = 0, 1000);
    }

    async function handleShare(){
      const ok = await safeCopy(window.location.href);
      alert(ok ? "é€£çµè¤‡è£½æˆåŠŸï¼" : "æ­¤ç€è¦½å™¨é™åˆ¶è¤‡è£½ï¼Œè«‹é•·æŒ‰ç¶²å€åˆ—è¤‡è£½");
    }

    function fixImg(url){
      if(!url) return "";
      const idMatch = url.match(/id=([-\w]+)/) || url.match(/d\/([-\w]+)/);
      return idMatch ? `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w1000` : url;
    }
    function splitPhotos(raw){
      if(!raw) return [];
      return raw.split(/[\n,]+/).map(s => s.trim()).filter(Boolean).slice(0, 3);
    }

    // âœ… ç©©å®š CSV è§£æï¼ˆä¿ç•™ä½ åŸé‚è¼¯ä½†æ›´ç©©ï¼‰
    function parseCSV(text){
      const rows = [];
      let row = [];
      let cur = '';
      let i = 0;
      let inQuotes = false;

      while(i < text.length){
        const ch = text[i];

        if(inQuotes){
          if(ch === '"'){
            const next = text[i+1];
            if(next === '"'){ cur += '"'; i += 2; continue; }
            inQuotes = false; i++; continue;
          }
          cur += ch; i++; continue;
        }else{
          if(ch === '"'){ inQuotes = true; i++; continue; }
          if(ch === ','){ row.push(cur.trim()); cur=''; i++; continue; }
          if(ch === '\n' || ch === '\r'){
            if(ch === '\r' && text[i+1] === '\n') i++;
            row.push(cur.trim()); cur='';
            if(row.some(c => c !== '')) rows.push(row);
            row = []; i++; continue;
          }
          cur += ch; i++; continue;
        }
      }
      row.push(cur.trim());
      if(row.some(c => c !== '')) rows.push(row);
      return rows;
    }

    async function loadSheetData(){
      const csvUrl = "https://docs.google.com/spreadsheets/d/16c21SGmuUVpKVnUrCvWt88OWZdepI76hawWW3DvNJMY/export?format=csv&gid=1350316682&t=" + Date.now();
      try{
        const res = await fetch(csvUrl);
        const text = await res.text();
        allRows = parseCSV(text);
      } catch(e){
        console.log("è³‡æ–™åŒæ­¥ä¸­");
      }
    }

    function renderMainFixedFirstRow(){
      if(!allRows[0] || !allRows[1]) return;
      applyRow(allRows[0], allRows[1], { isMainData:true, keepUiMain:true });
    }

    function renderById(keyword, keepUiMain){
      if(!keyword || !allRows[0]) return false;
      const h = allRows[0];
      const d = allRows.find((r, idx) => idx !== 0 && (r[0] == keyword || r[1] == keyword));
      if(!d) return false;
      applyRow(h, d, { isMainData:false, keepUiMain: !!keepUiMain });
      return true;
    }

    function doPreviewInPlace(){
      const id = (document.getElementById('work-id').value || "").trim();
      if(!id){ alert("è«‹å…ˆè¼¸å…¥åºè™Ÿæˆ–å§“å"); return; }
      const ok = renderById(id, true);
      if(!ok){ alert("æ‰¾ä¸åˆ°æ­¤åºè™Ÿ/å§“å"); return; }
      document.querySelector('.info-scroll')?.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function applyRow(h, d, opt){
      const isMainData = !!(opt && opt.isMainData);
      const keepUiMain = !!(opt && opt.keepUiMain);

      uiMain = keepUiMain ? true : !urlId;
      updateClass();

      const getVal = (key) => {
        const idx = h.findIndex(head => (head || "").includes(key));
        return (idx !== -1 && d[idx]) ? d[idx] : "";
      };

      const name   = getVal('å§“å');
      const unit   = getVal('å–®ä½') || getVal('å–®ä½åç¨±');
      const motto  = getVal('ç†å¿µæ¨™èª');
      const service= getVal('æœå‹™é …ç›®') || getVal('æœå‹™');
      const titles = getVal('é‡è¦é ­éŠœ') || getVal('çéŠœ');
      const avatar = fixImg(getVal('å€‹äººå°ˆæ¥­å½¢è±¡ç…§') || getVal('å½¢è±¡ç…§'));
      const photos = splitPhotos(getVal('ç”¢å“æˆ–å“ç‰Œç…§ç‰‡'));
      const logo   = fixImg(getVal('å“ç‰Œ Logo') || getVal('å“ç‰ŒLogo') || getVal('Logo'));
      const wechat = getVal('å¾®ä¿¡') || getVal('å¾®ä¿¡ ID');
      const email  = getVal('ä¸€éµè¯ç¹« Email') || getVal('Email') || getVal('éƒµç®±');
      const phone  = getVal('ä¸€éµè¯ç¹«é›»è©±') || getVal('é›»è©±');
      const lineP  = getVal('ç§è¨Š LINE') || getVal('LINE åŠ å¥½å‹') || getVal('å€‹äººå¥½å‹');
      const lineOA = getVal('LINE å®˜æ–¹') || getVal('å®˜æ–¹å¸³è™Ÿ');

      const q1 = getVal('å®¢æˆ¶å¸¸è¦‹æå• 1') || getVal('Q1');
      const a1 = getVal('å°ˆæ¥­è§£ç­” 1') || getVal('A1');
      const q2 = getVal('å®¢æˆ¶å¸¸è¦‹æå• 2') || getVal('Q2');
      const a2 = getVal('å°ˆæ¥­è§£ç­”2') || getVal('å°ˆæ¥­è§£ç­” 2') || getVal('A2');

      document.getElementById('u-name').innerText = name || "ï¼ˆæœªå¡«å§“åï¼‰";
      document.getElementById('u-unit').innerText = unit || "ï¼ˆæœªå¡«å–®ä½ï¼‰";
      document.getElementById('u-service').innerText = service || "å¹¸ç¦æ•™é¤Šç³»çµ±æ¨å»£";

      document.getElementById('u-img').src = avatar || "https://drive.google.com/thumbnail?id=18izl3Ym9zRDLtqe6zplRhB7mFjDA3tuB&sz=w1000";

      const mottoEl = document.getElementById('u-motto');
      if(motto){ mottoEl.style.display=''; mottoEl.innerText=motto; }
      else { mottoEl.style.display='none'; mottoEl.innerText=''; }

      const logoWrap = document.getElementById('brand-logo');
      const logoImg  = document.getElementById('u-logo');
      if(logo){
        logoImg.src = logo;
        logoWrap.style.display = 'flex';
      } else {
        logoImg.src = '';
        logoWrap.style.display = 'none';
      }

      const photosBox = document.getElementById('photos-box');
      if(photos.length){
        photosBox.style.display = '';
        const ids = [{a:'p1a',i:'p1'},{a:'p2a',i:'p2'},{a:'p3a',i:'p3'}];
        ids.forEach((x, idx) => {
          const a = document.getElementById(x.a);
          const img = document.getElementById(x.i);
          const raw = photos[idx] || "";
          if(raw){
            const fixed = fixImg(raw);
            a.href = raw;
            img.src = fixed || raw;
            a.style.display = '';
          } else {
            a.style.display = 'none';
            img.src = '';
          }
        });
      } else {
        photosBox.style.display = 'none';
      }

      const titlesBox = document.getElementById('titles-box');
      const titlesEl  = document.getElementById('u-titles');
      if(titles){
        titlesBox.style.display = '';
        titlesEl.innerText = titles;
      } else {
        titlesBox.style.display = 'none';
        titlesEl.innerText = '';
      }

      const faqBox = document.getElementById('faq-box');
      const faq1 = document.getElementById('faq-1');
      const faq2 = document.getElementById('faq-2');
      let anyFaq = false;

      if(q1 || a1){
        anyFaq = true;
        faq1.style.display = '';
        document.getElementById('q1').innerText = q1 || "å¸¸è¦‹æå•";
        document.getElementById('a1').innerText = a1 || "";
      } else {
        faq1.style.display = 'none';
      }

      if(q2 || a2){
        anyFaq = true;
        faq2.style.display = '';
        document.getElementById('q2').innerText = q2 || "å¸¸è¦‹æå•";
        document.getElementById('a2').innerText = a2 || "";
      } else {
        faq2.style.display = 'none';
      }
      faqBox.style.display = anyFaq ? '' : 'none';

      // âœ… äº¤è²¨é é¡¯ç¤ºå®‰è£æ•™å­¸
      if(isMainData){
        document.getElementById('advantage-box').style.display = 'block';
        document.getElementById('order-box').style.display = 'block';
        document.getElementById('install-entry').style.display = 'none';
        document.getElementById('wechat-id-text').innerText = "a0973180707";
        document.getElementById('line-guide').style.display = 'block';
      } else {
        document.getElementById('advantage-box').style.display = 'none';
        document.getElementById('order-box').style.display = 'none';
        document.getElementById('install-entry').style.display = 'block';
        document.getElementById('wechat-id-text').innerText = wechat || "æœªæä¾›";
        document.getElementById('line-guide').style.display = uiMain ? 'block' : 'none';
      }

      // âœ… äº¤è²¨é è¯çµ¡æŒ‰éˆ•
      if(!isMainData){
        const btnOA = document.getElementById('btn-oa');
        if(lineOA && lineOA.includes('http')){ btnOA.href = lineOA; btnOA.style.display = 'block'; }
        else { btnOA.style.display = 'none'; }

        const btnP = document.getElementById('btn-p');
        if(lineP && lineP.includes('http')){ btnP.href = lineP; btnP.style.display = 'block'; }
        else { btnP.style.display = 'none'; }

        const btnMail = document.getElementById('btn-mail');
        if(email){ btnMail.href = `mailto:${email}`; btnMail.style.display = 'block'; }
        else { btnMail.style.display = 'none'; }

        const actions = document.getElementById('actions-area');
        let phoneBtn = document.getElementById('btn-phone');
        if(!phoneBtn){
          phoneBtn = document.createElement('a');
          phoneBtn.id = 'btn-phone';
          phoneBtn.className = 'act-btn';
          phoneBtn.innerText = 'ğŸ“ ä¸€éµæ’¥è™Ÿ';
          actions.insertBefore(phoneBtn, document.getElementById('btn-p'));
        }
        if(phone){ phoneBtn.href = `tel:${phone.replace(/\s+/g,'')}`; phoneBtn.style.display = 'block'; }
        else { phoneBtn.style.display = 'none'; }

        const btnWechat = document.getElementById('btn-wechat');
        if(wechat){ btnWechat.style.display = 'block'; }
        else { btnWechat.style.display = 'none'; }
      } else {
        document.getElementById('btn-oa').style.display = 'block';
        document.getElementById('btn-p').style.display  = 'block';
        document.getElementById('btn-mail').style.display= 'block';
        document.getElementById('btn-wechat').style.display='block';
        const phoneBtn = document.getElementById('btn-phone');
        if(phoneBtn) phoneBtn.style.display = 'none';
      }
    }

    // âœ…ã€V335ã€‘ä½ è¦çš„ï¼šå‰è‡ºé¸å¥½ â†’ å¾Œè‡ºåªè¼¸å…¥å§“å â†’ ä¸€éµè¤‡è£½ã€Œå¸¶ç‰ˆå‹é¡è‰²ã€äº¤è²¨ç¶²å€
    async function doCopy(){
      const id = (document.getElementById('work-id').value || "").trim();
      if(!id){ alert("è«‹å…ˆè¼¸å…¥åºè™Ÿæˆ–å§“å"); return; }

      // ç¢ºä¿ç”¨ã€Œç›®å‰å·²é¸ã€çš„ theme/styleï¼ˆä¸¦å·²å­˜ localStorageï¼‰
      const finalUrl = `${window.location.origin}${window.location.pathname}?id=${encodeURIComponent(id)}&theme=${encodeURIComponent(curTheme)}&style=${encodeURIComponent(curStyle)}`;

      const ok = await safeCopy(finalUrl);
      alert(ok ? "âœ… äº¤è²¨ç¶²å€å·²è¤‡è£½ï¼ï¼ˆå·²å¸¶é¡è‰²/ç‰ˆå‹ï¼‰" : "æ­¤ç€è¦½å™¨é™åˆ¶è¤‡è£½ï¼Œè«‹æ‰‹å‹•è¤‡è£½ç¶²å€åˆ—");
    }

    async function init(){
      await loadSheetData();

      if(urlId){
        uiMain = false;
        const ok = renderById(urlId, false);
        if(!ok){
          uiMain = true;
          renderMainFixedFirstRow();
        }
      } else {
        uiMain = true;
        renderMainFixedFirstRow();
      }

      document.querySelectorAll('.btn-style').forEach(b => b.classList.remove('active'));
      const mapBtn = { arch:0, flat:1, spot:2 };
      const idx = mapBtn[curStyle] ?? 0;
      const btns = document.querySelectorAll('.btn-style');
      if(btns[idx]) btns[idx].classList.add('active');

      updateClass();
    }
    init();
  </script>
</body>
</html>